window.tec=window.tec||{},tec.classicEditorEvents=tec.classicEditorEvents||{},tec.classicEditorEvents.dayOfMonth=tec.classicEditorEvents.dayOfMonth||{},dayjs.extend(window.dayjs_plugin_isoWeek),dayjs.extend(window.dayjs_plugin_customParseFormat),function(e,t){"use strict";t.selectors={monthDayDropdown:'.custom-recurrence-months select[data-field="custom-month-day"]',monthNumberDropdown:'.custom-recurrence-months select[data-field="custom-month-number"]',monthOnTheDropdown:".tec-events-pro-month-on-the-dropdown",monthSameDayDropdown:".custom-recurrence-months .tribe-same-day-select",yearMonthDayDropdown:'[data-condition="Yearly"] select[data-field="custom-year-month-day"]',yearMonthNumberDropdown:'[data-condition="Yearly"] select[data-field="custom-year-month-number"]',yearNotSameDayDropdown:".tec-events-pro-year-not-same-day-dropdown",yearSameDayDropdown:'[data-condition="Yearly"] .tribe-dame-day-select .tribe-same-day-select'},t.typedSelectors={dayDropdown:"",numberDropdown:"",sameDayDropdown:"",combinedDropdown:""},t.setTypedSelectors=function(e){switch(e){case"Monthly":t.typedSelectors.dayDropdown=t.selectors.monthDayDropdown,t.typedSelectors.numberDropdown=t.selectors.monthNumberDropdown,t.typedSelectors.sameDayDropdown=t.selectors.monthSameDayDropdown,t.typedSelectors.combinedDropdown=t.selectors.monthOnTheDropdown;break;case"Yearly":t.typedSelectors.dayDropdown=t.selectors.yearMonthDayDropdown,t.typedSelectors.numberDropdown=t.selectors.yearMonthNumberDropdown,t.typedSelectors.sameDayDropdown=t.selectors.yearSameDayDropdown,t.typedSelectors.combinedDropdown=t.selectors.yearNotSameDayDropdown;break;default:t.typedSelectors.dayDropdown="",t.typedSelectors.numberDropdown="",t.typedSelectors.sameDayDropdown="",t.typedSelectors.combinedDropdown=""}},t.setTypedSelectorsFromRuleType=function(e){return t.setTypedSelectors(e),["Monthly","Yearly"].includes(e)},t.isDateDropdownMatchEventStart=function(e){const o=e.querySelector(t.typedSelectors.combinedDropdown).value.split("-");if(1===o.length){const e=tec.classicEditorEvents.eventDate.eventStart.moment.date();return o[0]===String(e)}if(2===o.length){const e=tec.classicEditorEvents.eventDate.eventStart.moment.isoWeekday(),t=tec.classicEditorEvents.eventDate.getEventStartWeekdayOrdinalValue(),n=tec.classicEditorEvents.eventDate.isEventStartWeekdayLast(),r=tec.classicEditorEvents.eventDate.isEventStartDateLastOfMonth(),a=o[0]===t||(n||r)&&"Last"===o[0],s=o[1]===String(e)||r&&"8"===o[1];return a&&s}return!1},t.isDateDropdownMatchNumberAndDayDropdowns=function(e){const o=e.querySelector(t.typedSelectors.combinedDropdown),n=e.querySelector(t.typedSelectors.numberDropdown),r=e.querySelector(t.typedSelectors.dayDropdown),a=o.value.split("-");return!!a.length&&!(a[0]!==n.value||a[1]&&a[1]!==r.value)},t.setDateDropdownValue=function(o,n){const r=!dayjs.isDayjs(tec.classicEditorEvents.eventDate.eventStart.prevMoment);let a;const s=o[0],d=s.childNodes[0].value;if(n&&!r){const e=Array.from(s.childNodes).map((e=>t.getMonthlyOnOptionTypeFromValue(e.value))).indexOf(n);a=e>=0?s.childNodes[e].value:d}if(r){const o=e(t.typedSelectors.numberDropdown).val();a=isNaN(o)?[o,e(t.typedSelectors.dayDropdown).val()].join("-"):o}o.val(a||d)},t.getMonthlyOnOptionTypeFromValue=function(e){return e?e.match(/last-8/i)?"last-day-in-month":e.match(/(first|second|third|fourth|fifth)-\d/i)?"day-of-week-in-month":e.match(/last-\d/i)?"last-day-of-week-in-month":"day-n":null},t.syncDateDropdownOptions=function(o){const n=o.querySelector(t.typedSelectors.combinedDropdown),r=t.getMonthlyOnOptionTypeFromValue(n.value);for(;n.firstChild;)n.removeChild(n.lastChild);const a=e(n),s=tec.classicEditorEvents.eventDate.getEventStartWeekdayOrdinalValue(),d=tec.classicEditorEvents.eventDate.getEventStartWeekdayName(),c=s.toLowerCase()+d,i=tribe_events_pro_recurrence_strings.customTablesV1.dayOfMonth.pattern[c],l=new Option(i.label,i.ordinal+"-"+i.day,!1,!0);if(a.append(l),tec.classicEditorEvents.eventDate.isEventStartWeekdayLast()){const e="Last"===o.querySelector('select[data-field="custom-month-number"]').value,t="last"+d,n=tribe_events_pro_recurrence_strings.customTablesV1.dayOfMonth.pattern[t],r=n.ordinal+"-"+n.day,s=new Option(n.label,r,!1,e);a.append(s)}if(tec.classicEditorEvents.eventDate.isEventStartDateLastOfMonth()){const e="lastDay",t=tribe_events_pro_recurrence_strings.customTablesV1.dayOfMonth.pattern[e],o=new Option(t.label,t.ordinal+"-"+t.day,!1,!1);a.append(o)}const y=e.isNumeric(o.querySelector('select[data-field="custom-month-number"]').value),p=tec.classicEditorEvents.eventDate.eventStart.moment.date(),D=tribe_events_pro_recurrence_strings.customTablesV1.dayOfMonth.date[p],m=new Option(D,p,!1,y);a.append(m),t.setDateDropdownValue(a,r),a.tribe_dropdowns().trigger("change")},t.syncDateDropdown=function(o,n){if(tec.classicEditorEvents.offStart.isRuleOffStart(o))return;if(tecEventDetails.isRdate)return;if(!t.setTypedSelectorsFromRuleType(n))return;const r=e(o);"yes"===r.find(t.typedSelectors.sameDayDropdown).val()&&r.find(t.typedSelectors.sameDayDropdown).val("no").trigger("change");const a=!dayjs.isDayjs(tec.classicEditorEvents.eventDate.eventStart.prevMoment),s=dayjs.isDayjs(tec.classicEditorEvents.eventDate.eventStart.moment)&&dayjs.isDayjs(tec.classicEditorEvents.eventDate.eventStart.prevMoment)&&tec.classicEditorEvents.eventDate.eventStart.moment.isSame(tec.classicEditorEvents.eventDate.eventStart.prevMoment,"day"),d=t.isDateDropdownMatchEventStart(o);!a&&s&&d?t.isDateDropdownMatchNumberAndDayDropdowns(o)||r.find(t.typedSelectors.combinedDropdown).trigger("change"):t.syncDateDropdownOptions(o)},t.handleDropdownChange=function(o){const n=o.target.value.split("-"),r=e(o.data.row),a=r.attr("data-recurrence-type");if(!t.setTypedSelectorsFromRuleType(a))return;const s=r.find(t.typedSelectors.numberDropdown),d=r.find(t.typedSelectors.dayDropdown);n.length&&n[0]&&(s.val(n[0]).trigger("change"),n[1]&&d.val(n[1]).trigger("change"))},t.bindRuleEvents=function(o){o.forEach((function(o){const n=e(o);n.find(t.selectors.monthOnTheDropdown).on("change",{row:o},t.handleDropdownChange),n.find(t.selectors.yearNotSameDayDropdown).on("change",{row:o},t.handleDropdownChange)}))}}(jQuery,tec.classicEditorEvents.dayOfMonth),window.tec=window.tec||{},window.tec.eventsPro=window.tec.eventsPro||{},window.tec.eventsPro.customTablesV1=window.tec.eventsPro.customTablesV1||{},window.tec.eventsPro.customTablesV1.classicEditorEventsDayOfMonth={};