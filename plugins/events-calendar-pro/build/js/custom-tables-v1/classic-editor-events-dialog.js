(()=>{var e,t;window.tec=window.tec||{},tec.classicEditorEventsDialog=tec.classicEditorEventsDialog||{},dayjs.extend(window.dayjs_plugin_customParseFormat),e=jQuery,(t=tec.classicEditorEventsDialog).selectors={saveButton:'input[name="save"]',publishButton:'input[name="publish"]',communityEventsSubmit:".events-community-submit",deleteButton:"#delete-action a.submitdelete"},t.l10n=window.tecEventsSeriesClassicEditor,t.updateType={all:"all",single:"single",upcoming:"upcoming"},t.phpToMomentDateFormatMap={d:"DD",j:"D",m:"MM",n:"M",Y:"YYYY"},t.clearDialogContent=function(){tec.editorDialog.el.$instance.empty()},t.getDialogText=function(e){return'<div class="tec-events-pro-dialog__text-row"><p class="tec-events-pro-dialog__text">'+e.text+"</p></div>"},t.getDialogRadioInput=function(e){const t=e.checked?"checked":"",n=["tec-events-pro-dialog__input-row","tec-events-pro-dialog__input-row--"+e.type].concat(e.classes).join(" "),l=["tec-events-pro-dialog__radio-input"].concat(e.inputClasses).join(" "),i=["tec-events-pro-dialog__radio-input-label"].concat(e.labelClasses).join(" "),a="tec-events-pro-dialog__radio-input--"+e.type;let s='<div class="'+n+'"><input type="radio" name="_tec_update_type" value="'+e.type+'" class="'+l+'" id="'+a+'" '+t+' /><label class="'+i+'" for="'+a+'">'+e.label;return e.labelHelpText&&(s+='<div><em style="font-style: italic; color: gray; font-size: 90%">'+e.labelHelpText+"</em></div>"),s+="</label></div>",s},t.setDialogContent=function(e){e.forEach((function(e){"text"===e.type?tec.editorDialog.el.$instance.append(t.getDialogText(e)):tec.editorDialog.el.$instance.append(t.getDialogRadioInput(e))}))},t.getDialogThisEventLabel=function(){const n=[t.l10n.thisEvent],l=tecEventSettings.datepickerFormat,i=Object.keys(t.phpToMomentDateFormatMap).reduce((function(e,n){return e.replace(n,t.phpToMomentDateFormatMap[n])}),l);let a=e(tec.classicEditorEvents.selectors.eventStartDate).val(),s=i;const o=e(tec.classicEditorEvents.selectors.allDayCheckbox).is(":checked");o||(a+=" "+e(tec.classicEditorEvents.selectors.eventStartTime).val(),s+=" H:mma");const c=dayjs(a,s);if(!c.isValid())return n[0];let r=c.format("MMMM D, YYYY");return r+=o?` ${t.l10n.allDay}`:tecEventSettings.dateTimeSeparator+c.format("H:mma"),r="("+r+")",n.push(r),n.join(" ")},t.getUpdateDialogContentSettings=function(){const e=[],n=tec.classicEditorEventsState.isStateKeyDirty("startDate"),l=tec.classicEditorEventsState.isOneOfStateKeysDirty(["recurrence","exclusion"]),i={single:!0,upcoming:!0,all:!0};return!n||tecEventDetails&&tecEventDetails.isRdate||(i.all=!1),l&&(i.single=!1),i.all||i.single?(i.single&&e.push({type:t.updateType.single,label:t.getDialogThisEventLabel(),labelHelpText:t.l10n.thisEventHelpText,classes:[],inputClasses:[],labelClasses:[],checked:!1}),e.push({type:t.updateType.upcoming,label:t.l10n.upcomingSetting,classes:[],inputClasses:[],labelClasses:[],checked:!i.all}),i.all&&e.push({type:t.updateType.all,label:t.l10n.allEvents,classes:[],inputClasses:[],labelClasses:[],checked:!0}),e):(e.push({type:"text",text:t.l10n.effectThisAndFollowingEventsWarning}),e.push({type:t.updateType.upcoming,label:t.l10n.upcomingSetting,classes:["hidden"],inputClasses:[],labelClasses:[],checked:!0}),e)},t.getDeleteDialogContentSettings=function(){const e=[];return e.push({type:t.updateType.single,label:t.getDialogThisEventLabel(),classes:[],inputClasses:[],labelClasses:[],checked:!1}),e.push({type:t.updateType.upcoming,label:t.l10n.upcomingSetting,classes:[],inputClasses:[],labelClasses:[],checked:!1}),e.push({type:t.updateType.all,label:t.l10n.allEvents,classes:[],inputClasses:[],labelClasses:[],checked:!0}),e},t.handleDialogConfirmButtonClick=function(e,t,n){return function(){if(!e||!e.length)return void tec.editorDialog.closeDialog();const l=tec.editorDialog.el.$instance.find("input:checked").val();if(l){if("trash"!==n)e.closest("form").append('<input type="hidden" name="'+n+'" value="'+l+'">');else{const t=e.attr("href");e.attr("href",t+"&_tec_update_type="+l)}e.off("click",t),e[0].click()}else tec.editorDialog.closeDialog()}},t.getUpdateDialogSettings=function(e){return Object.assign({},tec.editorDialog.defaultDialogSettings,{buttons:[{class:"button-primary",text:t.l10n.okButton,click:t.handleDialogConfirmButtonClick(e,t.showUpdatePrompt,"_tec_update_type")}]})},t.getDeleteDialogSettings=function(e){return Object.assign({},tec.editorDialog.defaultDialogSettings,{buttons:[{class:"button-primary",text:t.l10n.okButton,click:t.handleDialogConfirmButtonClick(e,t.showDeletePrompt,"trash")}]})},t.handleDuplicatedEventSave=function(n){n.preventDefault();const l=e(n.currentTarget);l.closest("form").append('<input type="hidden" name="_tec_update_type" value="'+t.updateType.all+'">'),l.off("click",t.showUpdatePrompt),l.click()},t.showUpdatePrompt=function(n){tecEventDetails.requiresFirstSave?t.handleDuplicatedEventSave(n):tec.classicEditorEventsState.initialState.isRecurring&&(n.preventDefault(),tec.editorDialog.el.$instance.attr("title",t.l10n.editModalTitle),t.clearDialogContent(),t.setDialogContent(t.getUpdateDialogContentSettings()),tec.editorDialog.setDialogSettings(t.getUpdateDialogSettings(e(n.currentTarget))),tec.editorDialog.openDialog())},t.showDeletePrompt=function(n){tec.classicEditorEventsState.initialState.isRecurring&&(n.preventDefault(),tec.editorDialog.el.$instance.attr("title",t.l10n.trashRecurringEvent),t.clearDialogContent(),t.setDialogContent(t.getDeleteDialogContentSettings()),tec.editorDialog.setDialogSettings(t.getDeleteDialogSettings(e(n.currentTarget))),tec.editorDialog.openDialog())},t.bindEvents=function(){const n=!tecEventDetails||!tecEventDetails.occurrence||tecEventDetails.occurrence.has_recurrence;e([t.selectors.saveButton,t.selectors.communityEventsSubmit].join()).on("click",t.showUpdatePrompt),n&&e(t.selectors.publishButton).on("click",t.showUpdatePrompt),e(t.selectors.deleteButton).on("click",t.showDeletePrompt)},t.ready=function(){t.bindEvents()},e(t.ready),window.tec=window.tec||{},window.tec.eventsPro=window.tec.eventsPro||{},window.tec.eventsPro.customTablesV1=window.tec.eventsPro.customTablesV1||{},window.tec.eventsPro.customTablesV1.classicEditorEventsDialog={}})();